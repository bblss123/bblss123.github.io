---
layout: post
title:  "AC自动机试水"
desc: "AC自动机的板子"
keywords: "AC自动机"
date: 2016-09-10
categories: [OI]
tags: [blog]
icon: fa-bookmark-o
---



这是一个板子页面

比他们慢了快一年，终于开始学AC自动机了。。

话说老外的板子真好看

### [HDU2222~~这题号也真是二~~](http://acm.split.hdu.edu.cn/showproblem.php?pid=2222)

```cpp
#include<iostream>
#include<algorithm>
#include<stdio.h>
#include<string.h>
using namespace std;
const int N=5e5;
const int M=1e6+5;
#define bug(x) cout<<#x<<"="<<x<<" "
#define debug(x) cout<<#x<<"="<<x<<endl
char str[M];
struct trie{
	struct node{
		int to[26],g,d;
	}tr[M];
	int allc,que[N];
	inline void clear(){
		for(int i=1;i<=allc;++i){
			for(int j=0;j<26;++j)
				tr[i].to[j]=0;
			tr[i].d=0;
		}
		allc=1;
	}
	inline void Insert(int len){
		int rt=1;
		for(int i=0;i<len;++i){
			if(!tr[rt].to[str[i]])
				tr[rt].to[str[i]]=++allc;
			rt=tr[rt].to[str[i]];
		}
		tr[rt].d+=1;
	}
	inline void build(){
		int l=0,r=0;
		for(que[r++]=1;l<r;){
			int v=que[l++];
			for(int i=0;i<26;++i){
				int j,s;
				for(j=tr[v].g;j;j=tr[j].g)
					if(tr[j].to[i])break;
						//沿着祖宗们的失配函数跳啊跳，调到祖宗的失配函数也可以包含自己为止 
				if(s=tr[v].to[i]){
					tr[s].g=j?tr[j].to[i]:1;
//					tr[s].d+=tr[tr[s].g].d;
					que[r++]=s;
				}
				else tr[v].to[i]=j?tr[j].to[i]:1;//补上一条边方便匹配 
			}
		}
	}
}ac;
inline void gao(){
	int n;cin>>n;
	ac.clear();
	for(int i=1;i<=n;++i){
		scanf("%s",str);
		int l=strlen(str);
		for(int j=0;j<l;++j)
			str[j]-='a';
		ac.Insert(l);
	}
	ac.build();
	scanf("%s",str);
	int m=strlen(str),res=0,rt=1;
	for(int i=0,j;i<m;++i){
		str[i]-='a';
		rt=ac.tr[rt].to[str[i]];
		if(ac.tr[rt].d){
			for(j=rt;;j=ac.tr[j].g){
				res+=ac.tr[j].d;
				ac.tr[j].d=0;
				if(j==1)break;
			}
		}
	}
	printf("%d\n",res);
}
int main(){
	int _;
	for(cin>>_;_--;)gao();
	return 0;
}
```

